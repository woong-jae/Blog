---
title: "댓글 기능 구현 - Utterances"
date: "2021-08-03"
emoji: "🗣"
category: "blog"
---

## Gatsby with Utterances
댓글 기능을 추가하기 위해 `utterance`를 사용했다. 이런 서비스를 "소셜 댓글 기능"이라고 한다. 댓글을 직접 구현하지 않고 내 서비스에 삽입하면 바로 사용 가능하다.

## 왜 Utterance?
요놈은 깃헙의 issues를 사용해서 댓글을 생성한다. 그래서 댓글에 마크다운을 사용할 수 있다.  
다른 장점으로는 가볍고, 광고도 안달리고, 공짜다. 하지만 내가 사용한 가장 큰 이유는 사용하기 쉬워서이다ㅎ.

## React에서 사용법
일반 HTML에 넣는 방법은 [공식 사이트](https://utteranc.es/)를 참조하길 바란다. 요놈 사용법이 `<script>`로 된 코드를 원하는 곳에 넣으면 끝인데... 리액트는 XSS를 막기 때문에 다른 방법을 사용해야 한다.  
`useEffect`를 사용해서 원하는 곳에 직접 `<script>` 요소를 생성해서 필요한 속성을 넣으면 된다.

```js
useEffect(() => {
    const script = document.createElement('script');
    script.src = 'https://utteranc.es/client.js';
    script.setAttribute('repo', 'woong-jae/Blog');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');
    script.async = true;

    const comments = document.getElementById(COMMENTS_ID);
    if (comments) comments.appendChild(script);

    // This function will get called when the component unmounts
    // To make sure we don't end up with multiple instances of the comments component
    return () => {
        const comments = document.getElementById(COMMENTS_ID);
        if (comments) comments.innerHTML = '';
    };
}, []);
```