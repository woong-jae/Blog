---
title: "DOM 조작 최적화하기"
date: "2022-04-05"
emoji: "🤼‍♂️"
category: "web"
---
## 렌더링(Rendering)
어찌됐든 저찌됐든 웹 어플리케이션의 가장 중요한 목표는 데이터를 화면에 보여주는 것이다.
데이터를 화면에 보여준다는 것은 결국 **요소를 화면에 렌더링하는 것**이다.
그리고 요소를 화면에 렌더링 요소들은 DOM으로 정의된다.

즉, 화면에 데이터를 '잘' 보여주기 위해서는 DOM 조작을 효과적으로 해야한다.

### 렌더링 과정
먼저 요소가 렌더링되는 과정을 살펴보자.

렌더링은 크게 '파싱' → '렌더 트리 구축' → '렌더 트리 배치(레이아웃)' → '렌더 트리 그리기(페인트)'의 순서대로 진행된다.
#### 파싱
이 단계에서 HTML 문서를 파싱해 'DOM 트리'를, CSS 파일을 파싱해 스티일 규칙인 'CSSOM 트리' 구축한다.

<img src="https://user-images.githubusercontent.com/49153756/103270821-2e29a700-49fc-11eb-9fcd-8807a27df98e.png" />

#### 렌더 트리 구축
DOM 트리와 CSSOM 트리가 생성되었으면 이 둘을 합쳐 렌더 트리를 구성한다.
렌더 트리에는 **페이지를 렌더링하는데 필요한 노드만 포함된다.**

> `display: none`인 요소는 레이아웃에 포함되지 않기 때문에 렌더링 트리에서 요소를 완전히 제거한다.

#### 렌더 트리 배치(레이아웃)
렌더 트리의 각 노드를 화면 상에 어디에 배치할 지 계산한다.
노드의 정확한 위치와 크기를 계산한다.

경우에 따라 '리플로우(reflow)'라고도 한다.

#### 렌더 트리 그리기(페인트)
렌더 트리의 각 노드를 화면의 실제 픽셀로 변환하는 단계다(래스터화).
이때가 되서야 우리가 보는 화면에 요소가 출력된다.

### 성능
레이아웃(Reflow)과 페인트(Repaint)는 상황에 따라 반복해서 발생할 수 있다.

**DOM의 추가/삭제, CSS 속성을 통해 기하학적인 변화가 일어나면 Reflow**가 발생하고,
**Reflow가 발생했거나 CSS 속성 변경이 기하학적 변화를 발생시키지 않을 때는 Repaint**가 발생한다.

여기서 문제점은 Reflow와 Repaint는 시간이 오래걸리는 작업이라는 것이다.
특히 Repaint보다 Reflow의 비용이 훨씬 높다.

DOM을 조작할 때 reflow가 최소한으로 발생하도록 해야 좋은 성능을 얻을 수 있다.

<br/>

참조:  
<https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Virtual-DOM/#_1-reflow-repaint>  
<https://kyu9341.github.io/WEB/2021/01/24/WEB_BrowserRendering/>

