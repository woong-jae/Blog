---
title: "[JS] DOM 트리" 
date: "2022-02-15"
emoji: "🪂"
category: "javascript"
---

***DOM(Document Object Model, 문서 객체 모델)***은 웹 페이지 내의 모든 콘텐츠를 객체로 나타내준다.

브라우저의 렌더링 엔진은 웹 문서를 로드한 후 모든 요소와 요소의 속성, 텍스트들을 각각의 객체로 만들고 이들 객체를 부자 관계로 표현한 트리구조를 만든다.
이 트리구조가 DOM이다. DOM은 자바스크립트를 통해 동적으로 변경할 수 있으며 변경된 DOM은 렌더링에 반영된다.

정적인 웹페이지에 접근하여 동적으로 웹페이지를 변경하기 위한 유일한 방법은 DOM을 변경하는 것이고, 이때 필요한 것이 DOM에 접근하고 변경하는 속성과 메소드이다(*DOM API*).

## DOM 트리
DOM은 HTML을 '객체의 트리'로 구조화한다.

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Simple DOM example</title>
  </head>
  <body>
      <section>
        <img src="dinosaur.png" alt="A red Tyrannosaurus Rex: A two legged dinosaur standing upright like a human, with small arms, and a large head with lots of sharp teeth." />
        <p>Here we will add a link to the <a href="https://www.mozilla.org/">Mozilla homepage</a></p>
      </section>
  </body>
</html>
```

<img src="https://developer.mozilla.org/ko/docs/Web/Web_Components/Using_shadow_DOM/dom-screenshot.png" />

DOM 트리의 노드 종류는 총 12가지인데, 보통 4가지만 주로 다룬다.
- **문서(document) 노드**: 트리의 최상위에 존재한다. DOM에 접근하기 위한 진입점이다.
- **요소 노드(element node)**: HTML 태그를 표현하고 DOM 트리를 구성한다.
- **속성 노드(attribute node)**: HTML 태그의 속성을 표현한다.
- **텍스트 노드**: HTML 요소의 텍스트를 표현한다. 텍스트 노드는 자식 노드를 가질 수 없다. 즉, DOM tree의 최종단이 된다.

참고로 HTML 내부의 주석또한 '주석 노드'로 DOM에 표현된다. **HTML 안의 모든 것은 DOM을 구성**한다.

위에 DOM 구조를 보면 빈 텍스트 노드들이 있다.
새 줄과 공백은 글자나 숫자처럼 유효한 문자로 취급된다. 
위 HTML을 보면 `<head>`와 `<meta>`사이에 새 줄과 약간의 공백이 있는데, 이런 것들이 텍스트 노드가 된 것이다.
빈 텍스트 노드들을 지우고 싶다면 모든 띄어쓰기와 들여쓰기를 지워 한 줄로 만들면 된다.

텍스트 노드는 **`<head>` 이전의 공백이나 새 줄**과 **`</body>` 뒤에 공백**을 제외한 모든 것을 텍스트 노드로 만든다.

## DOM 탐색하기
### 트리 상단
DOM 트리 상단의 노드들은 `document`가 제공하는 속성을 사용해 접근할 수 있다.
- `document.documentElement`: `<html>` 태그에 해당한다. `document`를 제외하면 DOM 트리 가장 상단에 있다.
- `document.body`: `<body>` 태그에 해당하는 DOM 노드다.
- `document.head`: `<head>` 태그에 해당한다.

### 자식노드 탐색하기
- **자식 노드**: 바로 아래의 자식 요소를 나타낸다. `<html>`의 자식 노드는 `<head>`와  `<body>`다.
- **후손 노드**: 중첩 관계에 있는 모든 요소를 의미한다.

`childNodes`는 모든 자식 노드를 담고 있다(텍스트 노드 포함).

아래 예시는 `document.body`의 모든 자식 노드를 출력한다.
```html
<html>
<body>
  <div>시작</div>

  <ul>
    <li>항목</li>
  </ul>

  <div>끝</div>

  <script>
    for (let i = 0; i < document.body.childNodes.length; i++) {
      alert( document.body.childNodes[i].nodeName );
    }
    // -> #text, DIV, #text, UL, ... , SCRIPT
  </script>
  ...추가 내용...
</body>
</html>
```

스크립트 아래 "...추가 내용..."이라는 내용이 있지만 출력되지 않는다. 스크립트 실행 시점엔 브라우저가 추가 내용은 읽지 못한 상태이기 때문이다.

`childNodes`는 배열 같아 보이지만, **이터러블 유사 배열 객체인 컬렉션(collection)**이다.
컬렉션은 `for..of`를 사용할 수 있지만 배열이 아니기 때문에 배열 메서드를 사용할 수 없다.
하지만 배열 메서드를 사용하고 싶을 땐, `Array.from`을 사용해 진짜 배열로 만들어 사용할 수 있다.

`firstChild`와 `lastChild` 속성을 이용하면 첫 번째, 마지막 자식 노드에 빠르게 접근할 수 있다.
`childNodes`나 방금 소개한 속성같은 **탐색용 속성들은 읽기 전용**이다. `=` 연산을 이용해 자식노드를 교체할 수 없다.
DOM을 변경하려면 다른 메서드가 필요하다.

자식 노드의 존재 여부를 검사할 수 있는 `elem.hasChildNodes()` 메서드도 존재한다.

### 형제와 부모 노드
다음 형제 노드에 대한 정보는 `nextSibling`, 이전 형제 노드에 대한 정보는 `previousSibling` 속성에서 찾을 수 있다.
`<body>`는 `<head>`의 '다음'에 있는 형제 노드이고, `<head>`는 `<body>` '이전'에 있는 형제 노드다.

부모 노드에 대한 정보는 충분히 예상가게도 `parentNode` 속성을 이용해 참조할 수 있다.

### 요소 간 이동
지금까지 언급한 탐색 관련 속성은 *모든 종류*의 노드를 참조한다. 하지만 보통 실전에서는 텍스트 노드나 주속 노드는 잘 다루지 않는다.
요소 노드만 다루기 위해서는 앞과 유사하지만 다른 속성들을 사용하면 된다.

- `children` 속성은 자식 노드 중 요소 노드만을 가리킨다.
- `firstElementChild`, `lastElementChild`는 각각 첫 번째 자식 요소 노드와 마지막 자식 요소 노드를 가리킨다.
- `previousElementSibling`, `nextElementSibling`도 아까 본 것과 비슷하지만 요소 노드만 가리킨다.
- `parentElement`는 부모 요소 노드를 가리킨다. 부모가 요소가 아니면 `null`을 반환한다.

<br/>

참조:  
ko.javascript.info  
<https://poiemaweb.com/js-dom>  
<https://developer.mozilla.org/ko/docs/Web/Web_Components/Using_shadow_DOM>